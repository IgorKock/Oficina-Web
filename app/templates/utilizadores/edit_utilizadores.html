{% extends "base.html" %}

{% block title %}Editar Utilizador - OficinaWeb{% endblock %}

{% block styles %}
<style>
    .card {
        background-color: #ffffff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        padding: 20px; margin-top: 20px; margin-bottom: 50px; border-top: 5px solid;
        border-image: linear-gradient(to right, #007bff, #00d4ff) 1;
    }
    .btn-primary { background-image: linear-gradient(to right, #007bff 0%, #0056b3 100%); border: none; background-size: 200% auto; }
    .btn-primary:hover { background-position: right center; }
    .input-group-text { background-color: #f8f9fa; border-right: 0; color: #6c757d; }
    .form-control { border-left: 0; padding-left: 0; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h4 fw-bold text-dark mb-0"><i class="bi bi-person-gear-fill text-primary me-2"></i> Editar Utilizador: {{ utilizador.nome }}</h2>
        <a href="{{ url_for('main.lista_utilizadores') }}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-2"></i>Voltar para a Lista</a>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-body p-lg-5">
            <form action="{{ url_for('main.edit_utilizador', id=utilizador.id) }}" method="POST">
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                    <div class="form-floating flex-grow-1">
                        <input type="text" class="form-control" id="nome" name="nome" value="{{ utilizador.nome }}" placeholder="Nome Completo" required>
                        <label for="nome">Nome Completo</label>
                    </div>
                </div>
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                    <div class="form-floating flex-grow-1">
                        <input type="email" class="form-control" id="email" name="email" value="{{ utilizador.email }}" placeholder="Email" required>
                        <label for="email">Email</label>
                    </div>
                </div>
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-phone-fill"></i></span>
                    <div class="form-floating flex-grow-1">
                        <input type="text" class="form-control telefone-input" id="telefone" name="telefone" value="{{ utilizador.telefone or '' }}" placeholder="Telefone (Opcional)">
                        <label for="telefone">Telefone (Opcional)</label>
                    </div>
                </div>
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-person-badge-fill"></i></span>
                    <div class="form-floating flex-grow-1">
                        <select class="form-select" id="papel_id" name="papel_id" required>
                            {% for papel in papeis %}
                                <option value="{{ papel.id }}" {% if papel in utilizador.papeis %}selected{% endif %}>{{ papel.nome }}</option>
                            {% endfor %}
                        </select>
                        <label for="papel_id">Papel</label>
                    </div>
                </div>
                
                <hr class="my-4">
                <h5 class="mb-3 text-center">Alterar Senha (Opcional)</h5>
                <p class="text-muted text-center mb-4">Deixe os campos de senha em branco se não quiser alterá-la.</p>

                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-key-fill"></i></span>
                    <div class="form-floating flex-grow-1">
                        <input type="password" class="form-control" id="senha" name="senha" placeholder="Nova Senha">
                        <label for="senha">Nova Senha</label>
                    </div>
                </div>
                <div class="input-group mb-4">
                    <span class="input-group-text"><i class="bi bi-key-fill"></i></span>
                    <div class="form-floating flex-grow-1">
                        <input type="password" class="form-control" id="confirmar_senha" name="confirmar_senha" placeholder="Confirmar Nova Senha">
                        <label for="confirmar_senha">Confirmar Nova Senha</label>
                    </div>
                </div>
                
                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary btn-lg fw-bold">
                        <i class="bi bi-check-circle-fill me-2"></i> ATUALIZAR UTILIZADOR
                    </button>
                    <a href="{{ url_for('main.lista_utilizadores') }}" class="btn btn-outline-secondary">CANCELAR</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('.telefone-input').mask('(00) 00000-0000');
});
</script>
{% endblock %}